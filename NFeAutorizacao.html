<!DOCTYPE html>
<html lang="en-US">

<!-- Mirrored from www.w3schools.com/css/default.asp by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 13 Mar 2016 05:37:02 GMT -->

<head>

  <title>Web Service Autorização</title>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="Keywords" content="NF-e, NFC-e, Encat, Web- Services, Nota Eltrônica, Nota Fiscal, Nota de Consumidor, Nota Fiscal de Consumidor Eletrônica">
  <meta name="Description" content="Manual de Orientação ao Contribuinte- Nota Fiscal Eletrônica">

  <link rel="stylesheet" type="text/css" href="estilo.css">
  <script src="myscript.js"></script>
  <link rel="icon" href="./Imagens/nfe_logo.png">
</head>

<body>

  <!-- Cabeçalho da pagina, que deve sumir quando dou o scroll-->
  <div class='cabecalho topo'>
    <div class='titulo'>
      <p><span><span style="font-size: 14pt;">Projeto Nota Fiscal Eletr&ocirc;nica</span></span></p>
      <p><span><span>Manual de Orienta&ccedil;&atilde;o ao Contribuinte</span></span></p>
    </div>
    <div class='imagens_cabecalho'>
      <img src="./Imagens/nfce_logo.png" alt="NFC-e" style="height:100%;width:auto;float:right ;">
      <img src="./Imagens/nfe_logo.png" alt="NF-e" style="height:100%;width:auto;float:right;">

    </div>
  </div>

  <!-- Barra de navegação superior, que deve ficar fixa no alto da pagina quando dou scroll -->



  <!--Essa primeira parte cria a barra, atribuindo os efeitos à ela -->
  <div class='linha_superior sombra barra_nav' id='barra_superior'>
    <div style='overflow:auto;'>
      <div style='float:left;width:100%;overflow:hidden;height:44px'>
        <!-- Aqui vai o índice geral do Manual-->
        <a href='javascript:void(0);' id="botao_menu" class='' onclick='menu()' title='Menu'>&#9776;</a>
        <a href='./index.html' title='Visão Geral'>Visão Geral</a>
        <div class='dropdown'>
          <a href='javascript:void(0);' id="botao_leiaute" title='Web Services'>Web Services</a>
          <div class='dropdown-content'>
            <a href='./NFeAutorizacao.html' title='WS Autorizacao'> Web Service- NFeAutorização</a>
            <a href='./NFeRetAutorizacao.html' title='WS RetAutorizacao'>Web Service- NFeRetAutorizacao</a>
            <a href='./NFeInutilizacao.html' title='WS Inutilizacao'>Web Service- NFeInutilização</a>
            <a href='./NFeConsultaProtocolo.html' title='WS Consulta Protocolo'>Web Service- NFeConsulta Protocolo</a>
            <a href='./NFeStatusServico.html' title='WS Status Serviço'>Web Service- NFeStatus Servico</a>
            <a href='./NFeConsultaCadastro.html' title='WS Consulta Cadastro'>Web Service- NFeConsultaCadastro</a>
            <a href='./NFeDistribuicaoDFe.html' title='WS Distribuição DFe'>Web Service- NFeDistribuicaoDFe</a>
            <a href='javascript:void(0);' title='WS Recepção Evento'>Web Service- NFeRecepcaoEvento</a>
            <a href='./RecepcaoEventoGeral.html' title='WS Autorizacao'>&emsp;&#8227;Parte Geral</a>
            <a href='./RecepcaoEventoCancelamento.html' title='WS Cancelamento por Substituição'>&emsp;&#8227;Cancelamento/Cancelamento por substituição</a>
            <a href='./RecepcaoEventoCartaCorrecao.html' title='WS Carta de Correção'>&emsp;&#8227;Carta de Correção</a>
            <a href='./RecepcaoEventoManifestacao.html' title='WS Manifestação do Destinatário'>&emsp;&#8227;Manifestação do Destinatário</a>
            <a href='./RecepcaoEventoEPEC.html' title='WS EPEC'>&emsp;&#8227;EPEC</a>
            <a href='./RecepcaoEventoProrrogacao.html' title='WS Pedido de Prorrogação'>&emsp;&#8227;Pedido de Prorrogação</a>
            <a href='./RecepcaoAtorInteressado.html' title='WS Ator Interessado'>&emsp;&#8227;Ator Interessado na NF-e - Transportador</a>
            <a href='./RecepcaoComprovanteEntrega.html' title='WS Ator Interessado'>&emsp;&#8227;Comprovante de Entrega da NF-e</a>
            <a href='./RecepcaoCancelamentoComprovante.html' title='WS Ator Interessado'>&emsp;&#8227;Cancelamento Comprovante de Entrega da NF-e </a>
          </div>
        </div>

        <div class='dropdown hide_leiaute'>
          <a href='./Leiaute.html' id="botao_leiaute" title='Leiaute'>Leiaute</a>
        </div>

        <div class='dropdown hide_regras_validacao'>
          <a href='./RegrasDeValidação.html' id="botao_leiaute" title='Regras de Validação'>Regras de Validação</a>
        </div>


        <div class='dropdown hide_danfe'>
          <a href='./DanfeCodigoBarras.html' id="botao_leiaute" title='Danfe/Código de Barras'>DANFE/Código de Barras</a>
        </div>

        <div class='dropdown hide_contingencia'>
          <a href='javascript:void(0);' id="botao_leiaute" title='Leiaute'>Contingência</a>
          <div class='dropdown-content'>
            <a href='./Contingencia_NFe.html' title='Contingência NF-e'>Contingência NF-e</a>
            <a href='./ContingenciaNFCe.html' title='Contingência NFC-e'>Contingência NFC-e</a>
          </div>
        </div>

        <div class='dropdown'>
          <a href='javascript:void(0);' id="botao_leiaute" title='Demais Anexos'><span class="show_anexo">Anexos</span></a>
          <div class='dropdown-content'>

            <div class="show_leiaute">
              <!--A classe show_leiaute garante que essas informações só serão exibidas dentro da aba de demais anexos quando a tela for inferior à 630 pixels -->
              <a href='./Leiaute.html' id="botao_leiaute" title='Leiaute'>Leiaute</a>
            </div>

            <div class="show_regras_validacao">
              <!--A classe show_regras_validacao garante que essas informações só serão exibidas dentro da aba de demais anexos quando a tela for inferior à 840 pixels -->
              <a href='./RegrasDeValidação.html' id="botao_leiaute" title='Regras de Validação'>Regras de Validação</a>
            </div>

            <div class="show_danfe">
              <!--A classe show_danfe garante que essas informações só serão exibidas dentro da aba de demais anexos quando a tela for inferior à 934 pixels -->
              <a href='./DanfeCodigoBarras.html' id="botao_leiaute" title='Danfe/Código de Barras'>DANFE/Código de Barras</a>
            </div>

            <div class="show_contingencia">
              <!--A classe show_contingencia garante que essas informações só serão exibidas dentro da aba de demais anexos quando a tela for inferior à 1100 pixels -->
              <a href='./Contingencia_NFe.html' title='Contingência NF-e'>Contingência NF-e</a>
              <a href='./ContingenciaNFCe.html' title='Contingência NFC-e'>Contingência NFC-e</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id='sub_barra'>
    <!-- Isso aqui estbelece uma divisao pra toda a parte abaixo da barra de navegacao-->
    <div id='menu_esq' style="display:none">
      <!-- isso aqui cria o menu lateral, à esquerda-->
      <div id='indice'>
        <!-- cria a parte interna do menu a esquerda-->
        <div id='indice_texto'>
          <!-- cria a parte interna da parte interna, para que fique abaixo da barra-->
          <!-- Aqui vai o índice específico dessa parte-->
          <input type="text" id="myInput" onkeyup="pesquisa()" placeholder="Pesquisar índice..">
          <h4 style="text-align:center">Web Service – NfeAutorizacao</h4>

          <a href='javascript:void(0);' id="botao_meiodatela" onclick='meiodatela("1.1. Leiaute Mensagem de Entrada")' title='1.1. Leiaute Mensagem de Entrada'>1<br><span class='subtitulo'>1.1. Leiaute Mensagem de Entrada</span></a><br>

        </div>
      </div>
    </div>


    <div class='corpo'>
      <div id='principal'>
        <h1>Web Service – NfeAutorizacao</h1>

        <ul>
          <div class="negrito">Função: </div>serviço destinado à recepção de mensagens de lote de NF-e.<br>
          <div class="negrito">Processo: </div>assíncrono/síncrono.<br>
          <div class="negrito">Método: </div>nfeAutorizacaoLote<br>
        </ul>
        <img src="./Imagens/NFeAutorizacao_1_fluxo.png" alt="Fluxo do Web Service nfeAutorizacaoLote (Recepção de Lote de NF-e)" class="imagem_central">
        <br><br>
        <titulo_tabela id="1.1. Leiaute Mensagem de Entrada">1.1. Leiaute Mensagem de Entrada</titulo_tabela><br>
        <ul>
          <div class="negrito"> Entrada: </div>Estrutura XML com as notas fiscais enviadas.<br>
          <div class="negrito">Schema XML: enviNFe_v4.00.xsd</div><br>
        </ul>
        <br>
        <table class="leiaute_web_services">
          <tr>
            <th>#</th>
            <th>Campo</th>
            <th>Ele</th>
            <th>Pai</th>
            <th>Tipo</th>
            <th>Ocor.</th>
            <th>Tam.</th>
            <th>Descrição/Observação</th>
          </tr>
          <tr class="linha_grupo">
            <td>AP01</td>
            <td>enviNFe</td>
            <td>Raiz</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>TAG raiz</td>
          </tr>
          <tr class="">
            <td>AP02</td>
            <td>versao</td>
            <td>A</td>
            <td>AP01</td>
            <td>N</td>
            <td>1-1</td>
            <td>1-2v2</td>
            <td>Versão do leiaute</td>
          </tr>
          <tr class="">
            <td>AP03</td>
            <td>idLote</td>
            <td>E</td>
            <td>AP01</td>
            <td>N</td>
            <td>1-1</td>
            <td>1-15</td>
            <td>Identificador de controle do envio do lote.<br> Número sequencial auto incremental, de controle correspondente ao identificador único do lote enviado. A responsabilidade de gerar e controlar esse número é exclusiva do contribuinte.
            </td>
          </tr>
          <tr class="">
            <td>AP03a</td>
            <td>indSinc</td>
            <td>E</td>
            <td>AP01</td>
            <td>N</td>
            <td>1-1</td>
            <td>1</td>
            <td>0=Não.<br>1=Empresa solicita processamento síncrono do Lote de NF-e (sem a geração de Recibo para consulta futura);<br><br>
              <div class="negrito">Nota: </div>O processamento síncrono do Lote corresponde a entrega da resposta do processamento das NF-e do Lote, sem a geração de um Recibo de Lote para consulta futura. A resposta de forma síncrona pela SEFAZ
              Autorizadora só ocorrerá se:<br>
              <div class="recuo"></div>• a empresa solicitar e constar unicamente uma NF-e no Lote;<br>
              <div class="recuo"></div>• a SEFAZ Autorizadora implementar o processamento síncrono para a resposta do Lote de NF-e.
            </td>
          </tr>
          <tr class="linha_grupo">
            <td>AP04</td>
            <td>NF-e</td>
            <td>G</td>
            <td>AP01</td>
            <td>xml</td>
            <td>1-50</td>
            <td>-</td>
            <td>Conjunto de NF-e transmitidas (máximo de 50 NF-e), seguindo definição do <a href="./Leiaute.html">Leiaute da NF-e</a>.
            </td>
          </tr>
        </table><br><br>
        <div class='texto_normal'>
          <p>O tamanho médio da NF-e é de aproximadamente 10 KB (dependendo da quantidade de itens), necessitando de um dimensionamento correto da rede interna e do canal de Internet das empresas e da SEFAZ.</p>
          <p>Para minimizar a necessidade de uma maior infraestrutura de rede, a mensagem de envio de Lote de NF-e poderá ser compactada, a critério da empresa (estima-se que a compactação da mensagem de Lote irá reduzir aproximadamente em 70% o
            tamanho desta mensagem), por meio das seguintes especificações:</p>

          <ul class="lista">
            <li>Nome do Web Service: “nfeAutorizacao”, conforme descrito neste item;</li>
            <li>Nome do Método: NfeAutorizacaoLoteZip;</li>
          </ul>

          <p>O novo método tem unicamente o parâmetro “nfeDadosMsgZip”, contendo a mensagem “enviNFe” compactada no padrão GZip, onde o resultado da compactação é convertido para Base64.</p>
          <p>A aplicação da SEFAZ irá descompactar a mensagem recebida, seguindo o procedimento normal do tratamento do Lote descompactado. Em caso de falha no processo de descompactação será retornado o erro “416 – Rejeição: Falha na descompactação
            da
            área de dados”.</p>
        </div>
        <br><br>
        <titulo_tabela id="1.2. Leiaute Mensagem de Retorno">1.2. Leiaute Mensagem de Retorno</titulo_tabela><br>
        <ul>
          <div class="negrito"> Retorno: </div>Estrutura XML com a mensagem do resultado da transmissão.<br>
          <div class="negrito">Schema XML: retEnviNFe_v4.00.xsd</div><br>
        </ul>
        <br>
        <table class="leiaute_web_services">
          <tr>
            <th>#</th>
            <th>Campo</th>
            <th>Ele</th>
            <th>Pai</th>
            <th>Tipo</th>
            <th>Ocor.</th>
            <th>Tam.</th>
            <th>Descrição/Observação</th>
          </tr>
          <tr class="linha_grupo">
            <td>AR01</td>
            <td>retEnviNFe</td>
            <td>Raiz</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>TAG raiz da Resposta</td>
          </tr>
          <tr class="">
            <td>AR02</td>
            <td>versao</td>
            <td>A</td>
            <td>AR01</td>
            <td>N</td>
            <td>1-1</td>
            <td>1-2v2</td>
            <td>Versão do leiaute</td>
          </tr>
          <tr>
            <td>AR03</td>
            <td>tpAmb</td>
            <td>E</td>
            <td>AR01</td>
            <td>N</td>
            <td>1-1</td>
            <td>1</td>
            <td>Identificação do Ambiente:<br>
              <div class="recuo"></div>1=Produção<br>
              <div class="recuo"></div>2= Homologação
            </td>
          </tr>
          <tr>
            <td>AR04</td>
            <td>verAplic</td>
            <td>E</td>
            <td>AR01</td>
            <td>C</td>
            <td>1-1</td>
            <td>1-20</td>
            <td>Versão do Aplicativo que recebeu o Lote. <br>A versão deve ser iniciada com a sigla da UF nos casos de WS próprio ou a sigla SVAN ou SVRS nos demais casos.</td>
          </tr>
          <tr>
            <td>AR05</td>
            <td>cStat</td>
            <td>E</td>
            <td>AR01</td>
            <td>N</td>
            <td>1-1</td>
            <td>3</td>
            <td>Código do status da resposta (<a href="./RegrasDeValidação.html#4.1. Tabela de Códigos de Resultado de Processamento (cStat)">conforme item 4.1 do Anexo Regras de Validação</a>)</td>
          </tr>
          <tr>
            <td>AR06</td>
            <td>xMotivo</td>
            <td>E</td>
            <td>AR01</td>
            <td>C</td>
            <td>1-1</td>
            <td>1-255</td>
            <td>Descrição literal do status da resposta</td>
          </tr>
          <tr>
            <td>AR06a</td>
            <td>cUF</td>
            <td>E</td>
            <td>AR01</td>
            <td>N</td>
            <td>1-1</td>
            <td>2</td>
            <td>Código da UF que atendeu a solicitação.</td>
          </tr>
          <tr>
            <td>AR06b</td>
            <td>dhRecbto</td>
            <td>E</td>
            <td>AR01</td>
            <td>D</td>
            <td>1-1</td>
            <td></td>
            <td>Preenchido com a data e hora do processamento (informado também no caso de rejeição). <br>Formato: “AAAA-MM-DDThh:mm:ssTZD” (UTC – Universal Coordinated Time).</td>
          </tr>
          <tr class="linha_grupo">
            <td>AR07</td>
            <td>infRec</td>
            <td>CG</td>
            <td>AR01</td>
            <td>-</td>
            <td>0-1</td>
            <td>-</td>
            <td>Dados do Recibo do Lote (Só é gerado se o Lote for aceito e o processamento for assíncrono)</td>
          </tr>
          <tr>
            <td>AR08</td>
            <td>nRec</td>
            <td>E</td>
            <td>AR07</td>
            <td>N</td>
            <td>1-1</td>
            <td>15</td>
            <td>Número do Recibo gerado pelo Portal da Secretaria de Fazenda Estadual, conforme descrição do item 4.3.4</td>
          </tr>
          <tr>
            <td>AR10</td>
            <td>tMed</td>
            <td>E</td>
            <td>AR07</td>
            <td>N</td>
            <td>1-1</td>
            <td>Nv1-4</td>
            <td>Tempo médio de resposta do serviço (em segundos) dos últimos 5 minutos, conforme descrição do item 4.3.6 Nota: Caso o tempo médio de resposta fique abaixo de 1 (um) segundo, o tempo será informado como 1 segundo. Arredondar as frações
              de segundos para cima.</td>
          </tr>
          <tr class="linha_grupo">
            <td>AR11</td>
            <td>protNFe</td>
            <td>CG</td>
            <td>AR01</td>
            <td>-</td>
            <td>0-1</td>
            <td>-</td>
            <td>Dados do Protocolo de recebimento da NF-e gerado no caso do processamento síncrono do Lote de NF-e, conforme descrito no item 5.2.2.</td>
          </tr>

        </table><br><br>

        <titulo_tabela id="1.3. Descrição do Processamento do Lote de NF-e">1.3. Descrição do Processamento do Lote de NF-e</titulo_tabela><br>
        <div class='texto_normal'>
          <p>No caso do processamento assíncrono, o processamento do Lote de NF-e recepcionado é realizado pelo Servidor de Processamento de NF-e, que consome as mensagens armazenadas na fila de entrada e faz a validação de forma e das regras de
            negócios e armazena o resultado do processamento na fila de saída.</p>

        </div>
        <titulo_tabela id="1.4. Geração da Resposta com o Recibo">1.4. Geração da Resposta com o Recibo</titulo_tabela><br>
        <ul>
          <titulo_tabela id="1.4.1. Erro no Lote">1.4.1 Erro no Lote</titulo_tabela><br>
          <div class='texto_normal'>
            <p>Caso ocorra algum problema de validação no Lote de NF-e, o aplicativo deverá retornar uma mensagem com as seguintes informações:</p>
        </ul>
        <ul class="lista">
          <li>a identificação do ambiente;</li>
          <li>a versão do aplicativo;</li>
          <li>o código e a respectiva mensagem de erro, segundo a estrutura da <a href="./index.html#4.7 Tabela">Tabela 4.7</a></li>
        </ul>
      </div>
      <ul>
        <titulo_tabela id="1.4.2. Processamento Assíncrono">1.4.2. Processamento Assíncrono</titulo_tabela><br>
        <div class='texto_normal'>
          <p>No caso de processamento assíncrono do Lote de NF-e, não existindo qualquer problema nas validações acima referidas, o aplicativo poderá gerar um número de recibo e gravar a mensagem, juntamente com o número do recibo e o CNPJ do
            transmissor. O número do recibo gerado pelo Portal da Secretaria de Fazenda Estadual será a chave de consulta do serviço de consulta ao resultado do processamento do lote.</p>
          <p>Após a gravação da mensagem na fila de entrada será retornada uma mensagem de confirmação de recebimento para o transmissor, com as seguintes informações:</p>
      </ul>
      <ul class="lista">
        <li>a identificação do ambiente;</li>
        <li>a versão do aplicativo;</li>
        <li>o código 103 e o literal "Lote recebido com Sucesso";</li>
        <li>o código da UF que atendeu a solicitação;</li>
        <li>o Número do Recibo de Lote de que trata o item <a href="./index.html#4.3.4 Tabela">Tabela 4.3.4</a>, com data, hora local de recebimento da mensagem;</li>
        <li>Tempo Médio de Resposta do serviço de processamento dos lotes nos últimos 5 minutos, tratado no item <a href="./index.html#4.3.6 Tabela">Tabela 4.3.6</a>;</li>
      </ul>
      <ul>

        <titulo_tabela id="1.4.3. Processamento Síncrono">1.4.3. Processamento Síncrono</titulo_tabela><br>
        <div class='texto_normal'>
          <p>No caso de processamento síncrono do Lote de NF-e, as validações da NF-e serão feitas na sequência, sem a geração de um Número de Recibo.</p>
        </div>
      </ul>
        </div>
      <titulo_tabela id="1.5. Regras de Validação">1.5. Regras de Validação</titulo_tabela><br>
      <div class='texto_normal'>
        <p>Serão aplicadas as regras de validação genéricas conforme os grupos citados na tabela abaixo, detalhados na <a href="./RegrasDeValidação.html#1.Regras de Validação Gerais">Seção 1 do Anexo de Regras de Validação da NF-e e da NFC-e.</a></p>
      </div>
      <table class="tabela_regras_genericas">
        <tr>
          <th>Grupo</th>
          <th>Descrição</th>
        </tr>
        <tr>
          <td>A</td>
          <td>Validação do Certificado de Transmissão (protocolo TLS)</td>
        </tr>
        <tr>
          <td>B</td>
          <td>Validação Inicial da Mensagem no Web Service</td>
        </tr>
        <tr>
          <td>D</td>
          <td>Validação da Área de Dados </td>
        </tr>
        <tr>
          <td>E</td>
          <td>Validação do Certificado Digital de Assinatura</td>
        </tr>
        <tr>
          <td>F</td>
          <td>Validação da Assinatura Digital</td>
        </tr>

      </table>
      <div class='texto_normal'>
        <p>As regras de validação específicas deste WS podem ser vistas no <a href="./RegrasDeValidação.html">Anexo de Regras de Validação da NF-e e da NFC-e.</a></p>
<br>
        <titulo_tabela id="1.6. Final do Processamento do Lote">1.6. Final do Processamento do Lote</titulo_tabela><br>
        <div class='texto_normal'>
          <p>A validação da NF-e poderá resultar em (NT 2017.001):</p>

          <ul class="lista">
            <li>Rejeição – a NF-e será descartada, não sendo armazenada no Banco de Dados podendo ser corrigida e novamente transmitida;</li>
            <li>Autorização de uso – a NF-e será armazenada no Banco de Dados;</li>
            <li>Denegação de uso – a NF-e será armazenada no Banco de Dados com esse status nos casos de irregularidade fiscal do emitente.</li>
          </ul>

          <p>Ou seja:</p>

          <table>
            <tr>
              <th colspan="2">Validação</td>
              <th colspan="4">Consequência</td>
            </tr>
            <tr>
              <th>NF-e</th>
              <th>Emitente</th>
              <th>Situação da NF-e</th>
              <th>Uso como Doc. Fiscal</th>
              <th>Para o contribuinte</th>
              <th>Banco de dados</th>
            </tr>
            <tr>
              <td>Inválida</td>
              <td>Irrelevante</td>
              <td>Rejeição</td>
              <td>Vedado</td>
              <td>Corrigir NF-e</td>
              <td>Não gravar</td>
            </tr>
            <tr>
              <td>Válida</td>
              <td>Irregular</td>
              <td>Denegação de Uso</td>
              <td>Vedado</td>
              <td>A operação não poderá ser realizada</td>
              <td>Gravar</td>
            </tr>
            <tr>
              <td>Válida</td>
              <td>Regular</td>
              <td>Autorização de Uso</td>
              <td>Permitido</td>
              <td>A operação está autorizada</td>
              <td>Gravar</td>
            </tr>
          </table>



    </div>


      <br><br><br><br><br><br><br><br><br><br><br><br>
    </div>
  </div>
  </div>


</body>
<!-- Mirrored from www.w3schools.com/css/default.asp by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 13 Mar 2016 05:41:03 GMT -->

</html>
